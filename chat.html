<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Chat</title>
  </head>
  <body>
    <!-- <form id="form" autocomplete="off" id="chat_form">
      <input id="chat_input" type="text" />
    </form> -->
    <p></p>
    <!-- <div id="future"></div> -->

    <div id="error-container"></div>
    <input
      id="name"
      type="text"
      name="name"
      value=""
      placeholder="Enter your name!"
    />
    <button type="button" name="button" onclick="setUsername()">
      Let me chat!
    </button>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io.connect();
      // var timeout;
      // socket.on("connect", data => {
      //   socket.emit("join", "Hello World from client");

      //   socket.on("broad", data => {
      //     $("#future").append(data + "<br/>");
      //   });

      // function timeoutFunction() {
      //   socket.emit("typing", false);
      // }
      // var message = document.getElementById("message");

      // $('#message').addEventListener("input", function() {
      //   if ($("#chat_input").val().length > 0) {
      //     socket.emit("isTyping", () => {
      //       socket.emit("typing", data);
      //     });
      //   } else {
      //     socket.emit("notTyping", () => {
      //       socket.emit("nottyping", data);
      //     });
      //   }
      // });

      // socket.on("typing", data => {
      //   $("p").empty();
      //   $("p").append(data);
      // });

      // socket.on("nottyping", data => {
      //   $("p").empty();
      //   $("p").append(data);
      // });

      //   $("form").submit(function(e) {
      //     e.preventDefault();
      //     var message = $("#chat_input").val();
      //     socket.emit("messages", message);
      //     $("#chat_input").val("");
      //   });
      // });

      function setUsername() {
        socket.emit("setUsername", document.getElementById("name").value);
      }
      var user;
      socket.on("userExists", function(data) {
        document.getElementById("error-container").innerHTML = data;
      });
      socket.on("userSet", function(data) {
        user = data.username;
        document.body.innerHTML =
          '<input type="text" id="message">\
         <button type = "button" name = "button" onclick = "sendMessage()">Send</button>\
         <div id="message-container"></div>';
      });
      function sendMessage() {
        var msg = document.getElementById("message").value;
        if (msg) {
          socket.emit("msg", { message: msg, user: user });
        }
      }
      socket.on("newmsg", function(data) {
        if (user) {
          document.getElementById("message-container").innerHTML +=
            "<div><b>" + data.user + "</b>: " + data.message + "</div>";
        }
      });
    </script>
  </body>
</html>
