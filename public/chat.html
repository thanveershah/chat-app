<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Chat</title>
  </head>
  <body>
    <form id="form" autocomplete="off" id="chat_form">
      <input id="chat_input" type="text" />
    </form>
    <p></p>
    <div id="future"></div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
      var socket = io.connect();
      var timeout;
      socket.on("connect", data => {
        socket.emit("join", "Hello World from client");

        socket.on("broad", data => {
          $("#future").append(data + "<br/>");
        });

        function timeoutFunction() {
          socket.emit("typing", false);
        }
        var message = document.getElementById("chat_input");

        message.addEventListener("input", function() {
          if ($("#chat_input").val().length > 0) {
            socket.emit("isTyping", () => {
              socket.emit("typing", data);
            });
          } else {
            socket.emit("notTyping", () => {
              socket.emit("nottyping", data);
            });
          }
        });

        socket.on("typing", data => {
          $("p").empty();
          $("p").append(data);
        });

        socket.on("nottyping", data => {
          $("p").empty();
          $("p").append(data);
        });

        $("form").submit(function(e) {
          e.preventDefault();
          var message = $("#chat_input").val();
          socket.emit("messages", message);
          $("#chat_input").val("");
        });
      });
    </script>
  </body>
</html>
